# 数据库覆盖操作指南

本指南说明如何使用 `cyrg202509` 数据库覆盖现有的 `cyrg2025` 数据库。

## 操作概述

此操作将：
1. 检查源数据库 `cyrg202509` 是否存在
2. 删除现有的 `cyrg2025` 数据库（如果存在）
3. 将 `cyrg202509` 重命名为 `cyrg2025`
4. 验证覆盖结果

## 执行方法

### 方法1：使用Shell脚本（推荐）

```bash
cd /Users/weijunyu/zhhotdog/database
./restore_cyrg202509_to_cyrg2025.sh
```

### 方法2：使用Python脚本

```bash
cd /Users/weijunyu/zhhotdog/database
python3 restore_cyrg202509_to_cyrg2025.py
```

### 方法3：使用SQL脚本

```bash
cd /Users/weijunyu/zhhotdog/database
sqlcmd -S "rm-uf660d00xovkm30678o.sqlserver.rds.aliyuncs.com,1433" \
       -U "hotdog" \
       -P "Zhkj@62102218" \
       -i restore_cyrg202509_to_cyrg2025.sql
```

## 前置条件

1. **确保源数据库存在**：`cyrg202509` 数据库必须存在于RDS实例中
2. **网络连接**：确保能够连接到阿里云RDS实例
3. **权限要求**：使用 `hotdog` 用户需要有足够的数据库管理权限
4. **工具安装**：
   - 对于Shell脚本：需要安装 `mssql-tools`（`brew install mssql-tools`）
   - 对于Python脚本：需要安装 `pyodbc`（`pip install pyodbc`）

## 安全注意事项

⚠️ **重要警告**：
- 此操作将**永久删除**现有的 `cyrg2025` 数据库
- 建议在执行前备份重要数据
- 确保 `cyrg202509` 数据库包含正确的数据
- 操作不可逆，请谨慎执行

## 操作步骤详解

### 1. 检查源数据库
脚本会首先检查 `cyrg202509` 数据库是否存在，并显示其基本信息（表数量、列数量、数据库大小）。

### 2. 处理目标数据库
如果 `cyrg2025` 数据库存在，脚本会：
- 断开所有活动连接
- 删除现有数据库

### 3. 执行重命名
将 `cyrg202509` 数据库重命名为 `cyrg2025`。

### 4. 验证结果
验证重命名是否成功，并显示新数据库的基本信息。

## 故障排除

### 常见问题

1. **连接失败**
   ```
   错误: 数据库连接失败
   ```
   - 检查网络连接
   - 验证RDS实例状态
   - 确认连接参数正确

2. **权限不足**
   ```
   错误: 权限不足
   ```
   - 确认用户有数据库管理权限
   - 联系数据库管理员

3. **源数据库不存在**
   ```
   错误: 源数据库 cyrg202509 不存在
   ```
   - 确认 `cyrg202509` 数据库已创建
   - 检查数据库名称拼写

4. **重命名失败**
   ```
   错误: 重命名数据库失败
   ```
   - 检查是否有其他进程占用数据库
   - 确认数据库处于可用状态

### 回滚方案

如果操作失败，可以：
1. 检查 `cyrg202509` 数据库是否仍然存在
2. 如果存在，可以重新执行脚本
3. 如果不存在，需要从备份恢复

## 验证成功

操作成功后，您应该看到：
- ✅ 数据库覆盖操作成功完成
- cyrg202509 已成功重命名为 cyrg2025
- 显示新数据库的表数量和列数量

## 后续步骤

操作完成后，建议：
1. 测试应用程序连接
2. 验证数据完整性
3. 更新相关配置文件（如果需要）
4. 监控系统运行状态

## 联系支持

如果遇到问题，请提供：
- 错误消息的完整内容
- 执行的操作步骤
- 系统环境信息
- 数据库连接参数（隐藏敏感信息）
