# 数据下钻功能指南

## 📊 功能概述

系统提供了完整的多层数据下钻功能，让用户从宏观概览逐步深入到订单详情。

## 🎯 数据下钻层级

### 第一层：KPI概览卡片
在运营模块的"运营概览"标签页中，提供了4个可点击的KPI卡片：

1. **销售额卡片**（蓝色）
   - 显示：今日/选定时间的总销售额
   - 点击：查看详细统计模态框

2. **客单价卡片**（绿色）
   - 显示：平均客单价
   - 点击：查看分时段统计

3. **总用户数卡片**（橙色）
   - 显示：活跃用户数
   - 点击：查看支付方式统计

4. **总订单数卡片**（紫色）
   - 显示：订单总数
   - 点击：查看商品销售统计

**使用方法**：
- 鼠标悬停时卡片会高亮
- 点击任意KPI卡片即可打开对应的统计详情

### 第二层：统计详情模态框
点击KPI卡片后，会弹出统计详情模态框，包含三种统计类型：

#### 1. 分时段统计（hourly）
- 显示24小时内每个小时的销售情况
- 数据：订单数量、销售金额、平均客单价
- 可视化：条形图展示销售趋势
- **可点击**：点击任意时段可查看该时段的订单列表

#### 2. 支付方式统计（payment）
- 显示各种支付方式的使用情况
- 数据：订单数量、销售金额、平均金额
- 可视化：饼图展示支付占比
- **可点击**：点击任意支付方式可查看相关订单列表

#### 3. 商品销售统计（product）
- 显示各商品的销售情况
- 数据：销售数量、销售金额、平均单价
- 排序：按销售量降序排列
- **可点击**：点击任意商品可查看相关订单列表

### 第三层：订单列表
从统计详情中点击后，会打开订单列表模态框：

**特性**：
- 分页显示：每页20条记录
- 筛选条件：根据前一层的选择自动筛选（时段/支付方式等）
- 显示字段：
  - 订单号
  - 订单金额
  - 支付方式
  - 支付状态
  - 下单时间
  - 客户ID

**使用方法**：
- 点击任意订单可查看完整订单详情
- 使用分页控件浏览更多订单

### 第四层：订单详情
点击订单列表中的订单后，会打开订单详情模态框：

**包含信息**：
1. **订单基本信息**
   - 订单号
   - 下单时间
   - 订单状态
   - 支付状态

2. **金额信息**
   - 订单总额
   - 支付方式
   - 现金支付
   - 会员卡支付
   - 储值卡支付

3. **客户信息**
   - 客户ID
   - 订单备注

4. **商品明细**（如有）
   - 商品名称
   - 数量
   -单价
   - 小计

## 📱 门店开业模块的下钻功能

在"门店开业"模块中，也提供了数据下钻功能：

### 门店列表 → 门店详情
1. 点击门店列表中的任意门店
2. 打开门店详情模态框，显示：
   - 门店基本信息
   - 经营数据统计（订单数、营收、客单价）
   - 点击"查看订单明细"按钮

### 门店详情 → 订单明细
1. 在门店详情模态框中点击"查看订单明细"
2. 打开订单明细列表，显示该门店的所有订单
3. 支持：
   - 分页浏览
   - 日期范围筛选
   - 列排序（点击列标题）

### 订单明细 → 订单详情
- 列表中的订单可点击查看完整详情
- 同运营模块的订单详情页面

## 🔮 销售预测功能

在运营模块中切换到"销售预测"标签页，提供完整的销售预测功能：

### 功能特性
1. **图表视图**（默认）
   - 显示历史销售数据和未来预测
   - 区分实际值和预测值
   - 可视化趋势分析

2. **数据列表视图**
   - 切换到表格视图查看详细数据
   - 支持数据导出

3. **预测控制**
   - 选择预测基准日期
   - 切换日/周视图
   - 设置预测时间范围

4. **预测准确度**
   - 显示置信度区间
   - 展示历史预测与实际对比
   - 提供预测因子说明

### 使用方法
1. 在运营模块顶部选择门店
2. 切换到"销售预测"标签
3. 在组件内部使用控制栏：
   - 左侧：选择显示模式（图表/列表）
   - 中间：选择视图类型（日/周）
   - 右侧：选择日期范围和基准日
4. 点击"重新生成预测"按钮刷新数据

## 💡 使用技巧

1. **快速定位问题**
   - 从KPI卡片发现异常指标
   - 点击进入详细统计查看细节
   - 继续下钻到具体订单

2. **数据对比分析**
   - 在统计详情中比较不同时段/支付方式
   - 在订单列表中筛选特定条件
   - 在订单详情中查看完整交易信息

3. **趋势分析**
   - 使用分时段统计查看销售高峰
   - 使用支付方式统计了解客户偏好
   - 使用商品统计发现畅销品

4. **排序和筛选**
   - 订单明细列表支持多列排序
   - 可按日期范围筛选
   - 支持导出数据进行进一步分析

## 🔍 示例场景

### 场景1：销售额异常调查
1. 发现今日销售额卡片显示异常低值
2. 点击销售额卡片查看详细统计
3. 在分时段统计中发现某时段订单为0
4. 点击该时段查看是否有系统问题

### 场景2：支付方式分析
1. 点击总用户数卡片
2. 查看支付方式统计
3. 发现某支付方式使用率低
4. 点击查看该支付方式的具体订单
5. 分析是否需要优化支付流程

### 场景3：商品销售优化
1. 点击总订单数卡片
2. 查看商品销售统计
3. 找出滞销商品
4. 点击查看相关订单详情
5. 制定商品优化策略

## ⚙️ 技术实现

### 前端技术
- React + TypeScript
- Ant Design UI组件
- 状态管理：useState, useEffect
- API调用：axios

### 后端API
- `/api/operations/dashboard/:storeId` - 门店仪表板数据
- `/api/operations/stores/:id/orders` - 门店订单列表
- `/api/operations/hourly-stats/:storeId` - 分时段统计
- `/api/operations/payment-stats/:storeId` - 支付统计
- `/api/operations/product-stats/:storeId` - 商品统计
- `/api/sales-prediction/predictions/:storeId` - 销售预测

### 数据流
```
KPI卡片点击
  ↓
设置currentStatsType状态
  ↓
打开statsModal显示对应统计
  ↓
统计项点击
  ↓
调用fetchOrderList with filters
  ↓
打开orderListModal显示订单列表
  ↓
订单项点击
  ↓
调用fetchOrderFullDetail
  ↓
打开orderFullDetailModal显示订单详情
```

## 📝 注意事项

1. **选择门店**：大部分下钻功能需要先选择门店
2. **数据权限**：确保有访问相应数据的权限
3. **日期范围**：注意当前选择的日期范围，影响显示的数据
4. **性能优化**：大量订单时注意使用分页和筛选功能

## 🐛 故障排除

### 点击KPI卡片无反应
- 检查是否已选择门店
- 确认数据已加载完成（不在loading状态）

### 统计详情为空
- 确认选定时间范围内有数据
- 检查网络连接
- 查看浏览器控制台错误信息

### 订单列表加载失败
- 确认后端服务运行正常
- 检查API请求参数
- 验证数据库连接


