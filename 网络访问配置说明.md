# 网络访问配置说明

本文档说明如何配置项目，使其可以通过IP地址在其他机器上访问。

## 1. 后端服务器配置

### 当前配置
后端服务器已经配置为监听所有网络接口（`0.0.0.0`），这意味着它可以通过IP地址访问。

### 端口
- 默认端口：`3001`
- 可通过环境变量 `PORT` 修改

### 防火墙设置
确保服务器防火墙允许访问后端端口：

**Linux/macOS:**
```bash
# 查看防火墙状态
sudo ufw status

# 允许3001端口（如果使用ufw）
sudo ufw allow 3001/tcp
```

**Windows:**
- 打开"Windows防火墙"
- 点击"高级设置"
- 添加入站规则，允许端口3001

## 2. 前端配置

### 方式一：使用环境变量（推荐）

创建 `.env` 文件在 `frontend` 目录下：

```env
# 开发环境 - 替换为实际的服务器IP地址
REACT_APP_API_BASE_URL=http://192.168.1.100:3001/api

# 例如，如果服务器IP是 192.168.1.100，则：
# REACT_APP_API_BASE_URL=http://192.168.1.100:3001/api
```

### 方式二：生产环境自动检测

在生产环境中，前端会自动使用当前访问的域名/IP。

例如：
- 如果通过 `http://192.168.1.100:3000` 访问前端
- 前端会自动使用 `http://192.168.1.100:3000/api` 作为API地址
- 但需要确保后端也在同一端口或有正确的代理配置

### 方式三：修改proxy配置（仅开发环境）

修改 `frontend/package.json`:

```json
{
  "proxy": "http://192.168.1.100:3001"
}
```

**注意：** 这种方式只在开发环境（`npm start`）时有效。

## 3. 启动步骤

### 1. 获取服务器IP地址

**Linux/macOS:**
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
# 或者
ip addr show | grep "inet " | grep -v 127.0.0.1
```

**Windows:**
```cmd
ipconfig
# 查找 IPv4 地址
```

### 2. 配置前端

在 `frontend` 目录下创建 `.env` 文件：

```env
REACT_APP_API_BASE_URL=http://<服务器IP>:3001/api
```

例如，如果服务器IP是 `192.168.1.100`：
```env
REACT_APP_API_BASE_URL=http://192.168.1.100:3001/api
```

### 3. 启动服务

**后端：**
```bash
cd backend
npm run build
npm run dev
```

**前端：**
```bash
cd frontend
npm start
# 或者生产环境
npm run build
# 然后使用serve或其他静态服务器
npx serve -s build -l 3000
```

### 4. 访问

从其他机器访问：
- 前端：`http://<服务器IP>:3000`
- 后端API：`http://<服务器IP>:3001/api`
- API文档：`http://<服务器IP>:3001/api-docs`

## 4. 生产环境部署建议

### 使用反向代理（推荐）

使用 Nginx 作为反向代理：

```nginx
# /etc/nginx/sites-available/hotdog
server {
    listen 80;
    server_name your-domain.com;  # 或服务器IP

    # 前端静态文件
    location / {
        root /path/to/frontend/build;
        try_files $uri $uri/ /index.html;
    }

    # 后端API代理
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

这样配置后：
- 前端访问：`http://服务器IP` 或 `http://your-domain.com`
- API自动通过 `/api` 路径访问后端

## 5. 常见问题

### Q: 前端无法连接到后端API
**A:** 
1. 检查防火墙是否开放端口
2. 检查后端是否监听 `0.0.0.0`（已经在代码中配置）
3. 检查 `REACT_APP_API_BASE_URL` 环境变量是否正确
4. 检查后端服务是否正常运行

### Q: CORS错误
**A:** 
后端已经配置为允许跨域访问。如果还有问题，检查：
1. 后端CORS配置是否正确
2. 前端请求的URL是否正确
3. 浏览器控制台的完整错误信息

### Q: 生产环境如何配置
**A:**
1. 使用环境变量 `REACT_APP_API_BASE_URL`
2. 或使用反向代理（Nginx）
3. 确保前端和后端使用相同的协议（http或https）

## 6. 安全检查

### 生产环境建议

1. **限制CORS来源：**
   ```typescript
   app.use(cors({
     origin: ['http://your-domain.com', 'https://your-domain.com'],
     credentials: true,
   }));
   ```

2. **使用HTTPS：** 在生产环境中使用HTTPS

3. **防火墙规则：** 只开放必要的端口

4. **API密钥：** 确保敏感API密钥不在前端代码中

## 7. 快速测试

1. 确保后端运行在 `0.0.0.0:3001`
2. 在 `frontend/.env` 设置 `REACT_APP_API_BASE_URL=http://<服务器IP>:3001/api`
3. 重启前端服务
4. 从其他机器访问 `http://<服务器IP>:3000`

