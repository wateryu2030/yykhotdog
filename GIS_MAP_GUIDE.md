# GIS地图可视化使用指南

## 功能概述

GIS地图可视化模块基于高德地图，提供直观的意向铺位位置展示和周边环境分析功能。

## 主要功能

### 1. 地图展示
- **高德地图底图**：使用高德地图作为基础底图
- **铺位标记**：在地图上显示所有意向铺位位置
- **评分可视化**：通过颜色和数字显示铺位评分

### 2. 筛选功能
- **城市筛选**：按城市筛选铺位
- **状态筛选**：按分析状态筛选（已分析/待分析/已拒绝）
- **评分筛选**：按评分等级筛选（优秀≥80/良好60-79/较差<60）
- **搜索功能**：按铺位名称或地址搜索

### 3. 信息展示
- **点击标记**：点击地图标记查看详细信息
- **信息窗口**：显示铺位基本信息、评分、预测营收等
- **周边环境**：显示周边POI信息（餐厅、学校、医院、银行、交通等）

### 4. 可视化元素
- **颜色编码**：
  - 绿色：低风险铺位
  - 黄色：中风险铺位  
  - 红色：高风险铺位
- **状态标签**：显示铺位当前状态
- **评分数字**：标记上显示评分数字

## 使用步骤

### 1. 配置高德地图API
1. 访问 [高德开放平台](https://lbs.amap.com/)
2. 注册账号并创建应用
3. 获取Web服务API密钥
4. 在 `frontend/src/config/amap.ts` 中配置API密钥：
```typescript
export const AMAP_CONFIG = {
  key: 'your_actual_api_key_here', // 替换为实际API密钥
  // ...
};
```

### 2. 访问地图页面
1. 启动前后端服务
2. 访问 http://localhost:3000/gis-map
3. 等待地图加载完成

### 3. 使用筛选功能
1. 使用顶部筛选器筛选铺位
2. 使用搜索框搜索特定铺位
3. 地图会实时更新显示的标记

### 4. 查看详细信息
1. 点击地图上的标记
2. 查看弹出的信息窗口
3. 点击"查看周边环境"获取POI数据

## 技术实现

### 前端技术栈
- **React 18**：组件框架
- **@amap/amap-react**：高德地图React组件
- **Ant Design**：UI组件库
- **TypeScript**：类型安全

### 后端API
- **GET /api/site-selection/candidates**：获取意向铺位列表
- **POST /api/site-selection/analyze**：分析铺位周边环境

### 数据流程
1. 前端请求铺位数据
2. 解析坐标信息
3. 在地图上渲染标记
4. 用户交互触发详细信息请求
5. 显示周边POI数据

## 注意事项

### 1. API限制
- 高德地图API有调用频率限制
- 建议申请企业版API以获得更高配额
- 当前使用免费版API，可能遇到限流

### 2. 数据质量
- 确保铺位数据包含有效的坐标信息
- 坐标格式应为 "经度,纬度"
- 无效坐标的铺位不会在地图上显示

### 3. 性能优化
- 大量铺位数据时建议使用分页加载
- 可以按区域或城市分批加载数据
- 考虑使用地图聚合功能优化显示

## 扩展功能

### 1. 路线规划
- 集成高德地图路线规划API
- 显示从当前位置到铺位的路线
- 计算交通时间和距离

### 2. 热力图
- 基于铺位评分生成热力图
- 直观显示区域商业价值分布
- 支持时间维度变化

### 3. 区域分析
- 绘制商圈范围
- 分析区域内竞争情况
- 计算区域平均评分

### 4. 数据导出
- 导出地图视图为图片
- 导出铺位数据为Excel
- 生成选址分析报告

## 故障排除

### 1. 地图不显示
- 检查API密钥是否正确配置
- 确认网络连接正常
- 查看浏览器控制台错误信息

### 2. 标记不显示
- 检查铺位数据中的坐标格式
- 确认坐标值在有效范围内
- 查看数据加载是否成功

### 3. POI数据获取失败
- 检查后端API是否正常
- 确认高德地图API配额是否充足
- 查看网络请求状态

## 更新日志

### v1.0.0 (2025-10-28)
- 初始版本发布
- 基础地图展示功能
- 铺位标记和信息窗口
- 筛选和搜索功能
- 周边POI展示
